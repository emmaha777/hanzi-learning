# 数据存储机制详解

## 📦 localStorage 的工作原理

localStorage 是基于**域名（origin）**存储的，这意味着：

- ✅ **同一域名**：数据共享
- ❌ **不同域名**：数据完全独立

## 🔍 本地开发 vs 部署到网络的区别

### 本地开发环境

```
http://localhost:3000
http://127.0.0.1:3000
```

**存储位置**：
- 浏览器为 `localhost:3000` 创建独立的 localStorage
- 数据保存在：`浏览器 → Application → Local Storage → http://localhost:3000`

### 部署到网络后

```
https://yourname.vercel.app
https://yourname.github.io/hanzi-learning
https://yourname.netlify.app
```

**存储位置**：
- 浏览器为部署域名创建独立的 localStorage
- 数据保存在：`浏览器 → Application → Local Storage → https://yourname.vercel.app`

## ⚠️ 重要区别

### 1. 数据隔离

**本地开发的数据 ≠ 部署后的数据**

- 在 `localhost:3000` 学习的数据，不会出现在部署后的网站上
- 在部署网站上学习的数据，不会出现在本地开发环境
- **它们是两个完全独立的数据存储空间**

### 2. 存储机制相同

虽然数据是隔离的，但**存储机制完全一样**：
- ✅ 都使用 localStorage
- ✅ 都自动保存
- ✅ 都支持备份机制
- ✅ 关闭页面后重新打开，数据都会保留

### 3. 跨设备/浏览器

**同一域名，不同浏览器**：
- Chrome 的数据 ≠ Firefox 的数据
- 每个浏览器都有独立的 localStorage

**同一域名，不同设备**：
- 手机上的数据 ≠ 电脑上的数据
- 每个设备都有独立的 localStorage

## 📊 数据存储位置对比

| 环境 | 域名示例 | 数据存储位置 | 数据是否共享 |
|------|---------|------------|------------|
| 本地开发 | `localhost:3000` | 浏览器 localStorage | ❌ 不共享 |
| Vercel 部署 | `yourname.vercel.app` | 浏览器 localStorage | ❌ 不共享 |
| GitHub Pages | `yourname.github.io` | 浏览器 localStorage | ❌ 不共享 |
| Netlify 部署 | `yourname.netlify.app` | 浏览器 localStorage | ❌ 不共享 |

**结论**：每个域名都有自己独立的 localStorage，数据互不干扰。

## 🔄 数据迁移（本地 ↔ 部署）

如果你在本地开发时积累了很多数据，想要迁移到部署后的网站（或反之），现在可以使用**导出/导入功能**！

### ✅ 方法：使用导出/导入按钮（推荐）

**从本地迁移到部署网站**：

1. **在本地导出数据**：
   - 打开本地开发环境（`http://localhost:3000`）
   - 点击顶部菜单的 **"导出数据"** 按钮
   - 会下载一个 JSON 文件（如 `hanzi-learning-backup-2024-01-15.json`）

2. **在部署网站导入数据**：
   - 打开部署后的网站（如 `https://yourname.vercel.app`）
   - 点击顶部菜单的 **"导入数据"** 按钮
   - 选择刚才下载的 JSON 文件
   - 确认导入，完成！

**从部署网站迁移到本地**：

步骤相同，只是顺序相反：
1. 在部署网站点击"导出数据"
2. 在本地开发环境点击"导入数据"

### 📦 导出文件包含什么？

导出的 JSON 文件包含：
- ✅ 所有汉字的学习进度（cards）
- ✅ 所有设置（settings）
- ✅ 导出日期和时间
- ✅ 版本信息

### ⚠️ 注意事项

- **导入会覆盖当前数据**：导入前建议先导出当前数据作为备份
- **数据格式验证**：导入时会自动验证数据格式，格式不正确会提示错误
- **跨环境兼容**：本地和部署环境的数据格式完全兼容，可以自由迁移

### 🔧 手动方法（备用）

如果导出/导入按钮不可用，可以手动操作：

1. **导出本地数据**：
   - 打开本地开发环境
   - 按 F12 打开开发者工具
   - Application → Local Storage → `http://localhost:3000`
   - 找到 `cn_cards_v1`，复制 JSON 数据

2. **导入到部署网站**：
   - 打开部署后的网站
   - 按 F12 打开开发者工具
   - Console 标签页
   - 运行：
     ```javascript
     localStorage.setItem('cn_cards_v1', '粘贴你复制的JSON数据');
     location.reload();
     ```

## 💡 实际使用建议

### 场景 1：只在本地使用

- ✅ 数据会持久保存
- ✅ 关闭页面后重新打开，数据还在
- ⚠️ 换电脑或重装系统会丢失数据（除非备份）

### 场景 2：部署到网络使用

- ✅ 数据会持久保存
- ✅ 任何设备访问同一域名，数据都在（但每个设备独立）
- ✅ 换电脑也能访问（但数据不会自动同步）
- ⚠️ 清除浏览器缓存会丢失数据

### 场景 3：多设备同步（未来功能）

如果需要多设备同步，需要：
- 添加用户登录功能
- 使用后端服务（Firebase、Supabase 等）
- 将数据存储到云端数据库

## 🎯 总结

**存储机制**：本地和部署后**完全相同**（都是 localStorage）

**数据位置**：本地和部署后**完全独立**（不同域名 = 不同存储空间）

**持久性**：本地和部署后**都能持久保存**（只要不清除浏览器缓存）

**建议**：
- 如果只在本地使用，直接用本地开发环境即可
- 如果想在任何地方访问，部署到网络更方便
- 如果想多设备同步，需要添加后端服务（未来功能）

